---
title: "Biden To Win the 2020 U.S. Popular Vote and Electoral College"
author: "Jin Long Cao, Brian Diep, Johnathan Tillman, Tanya Woloshansky"
date: "2/11/2020"
output: pdf_document
---

```{r setup, include=FALSE}

#Import libraries
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(broom)
library(brms)
library(here)
library(skimr)
library(usmap)
library(ggplot2)
library(RColorBrewer)

# Download datasets and run scripts first to get these csv files
census_data <- read_csv("census_data.csv")
survey_data <- read_csv("survey_data.csv")
```


## Keywords
BIDEN, TRUMP, 2020 US ELECTION, FORECASTING, MULTILEVEL REGRESSION WITH POSTSTRATIFICATION

## Abstract

  The U.S. election is one of the most important political processes in the world, the outcome of which can completely change the direction of American domestic and foreign policy. Thus it is relevant to many observers whether the Republican Party under Donald Trump will remain a second-term or if the Democratic Party under Joe Biden will replace him in the 2020 election. We approach forecasting the election by combining survey and census data from the Nationscapes and ACS respectively, in order to perform a multilevel regression using a Bayesian hierarchical model with poststratification. Through this methodology we predict that Biden is likely to win the popular vote with approximately 50.4% of the votes as well as the electoral college by winning 284 electoral votes over Trump's 254 votes.

## Introduction

  The 2020 U.S. federal election is shaping up to be one of the most divisive and hotly contested elections in recent history. Important issues such as climate change, gun control, COVID-19 response, and foreign trade policy are being discussed during this election cycle. The two major parties, the Republicans and the Democrats, are at odds for many of these key issues. This makes forecasting the election an important task for Americans and non-Americans alike. Although a key part of the electoral tradition is placed on the significance of each individual's vote, we can still find that almost all voters fall into broad categories that constitute voting blocs. These blocs can be united from many disparate categories such as age, race, and state of residence and many voters will identify with multiple blocs simultaneously. Although this is not an easy task, an analysis of these blocs can allow pollsters to predict the outcome of the federal election. For our purposes we combine individual survey data from the Democratic Fund's Nationscape Study and census data from the 2018 American Community Survey (ACS) to use a multilevel regression with poststratification. 
    
  In order to use Bayesian multilevel logistic modelling, variables associated with voter preference were extracted from the Nationscape study. In particular, age, state, income, race, gender, Hispanic identity and employment were decided upon as predictors since exploratory analysis of the data showed a significant relationship (p-value less than 0.05 via logistic regression models) with these and voting intentions. Poststratification was performed using the ACS data to incorporate the population distributions of the U.S. population. The outcome of our simulation, which paid attention to the Electoral college wins rather than the popular vote, predicted Joe Biden as the winner of the 2020 election. 

  This work will continue to further explore the data sets used in our modelling, summarizing features of the data and visualizing variables of interest to our model. Next the features of our model and post-stratification process are described prior to simulating the election on the Electoral College. Finally, the prediction of Joe Biden's win will be investigated further and a discussion follows into strengths and weaknesses of the model, why this information is useful and further avenues of study. 

## Data

## Nationscape Data

  The dataset we used for our analysis came from responses to the Nationscape survey. The survey is the result of a partnership between the Democracy Fund Voter Study Group and two Political Scientists at UCLA (Chris Tausanovitch and Lynn Vavreck). The Nationscape survey runs from July 2019 to December 2020, interviewing 6250 people per week for a total of 500,000 respondents. The population of interest for the study is everyone eligible to vote in the US and the population frame are all the respondents sent by the market research platform Lucid to the Nationscape team. The team sampled the respondents sent until a quota on different demographic groups of age, gender, ethnicity, region, income, and education were reached. 

  The individual samples of 6250 respondents were sent directly from Lucid to the Nationscape survey software. Of the 6250 survey invitations sent, only about 75% of those surveys are included in the data as 12% decline immediately. Around 5% of the respondents are omitted because they stop participating during the survey and 8% are removed for speeding through the survey or straight line selecting answers. Lucid also requires an attention check before the survey is conducted and their supply partners that help form samples are evaluated by third party data specialists to ensure accurate representation of the target population..

	The Nationscape team used a simple raking technique to transform their dataset to more accurately represent the US voting population. Raking involves adjusting weights of different demographic groups of a dataset to be proportional to the population of interest. The data is also checked for representativeness in a process used by Pew Research center. To do so, a number of questions are asked which are found on reliable, large scale, government surveys. Estimates from Nationscape surveys are then compared with government surveys, and the difference was in line with that produced by Pew Research.

  When mining for important variables, there were many categories where questions were not asked of all participants. While this is necessary to avoid too many people quitting the survey, some questions had a concrete answer for only 25% of respondents (such as the query regarding Medicare). Another weakness of the survey is that it is only available online and in English, which may deter those who are not comfortable with technology or English. Since the survey is done online, the frame is limited to all Americans that have access to the internet, are reachable online and own a device that is compatible with the software. The survey itself was also only available in English, thus limiting representation from non-native english speakers.
 




```{r race_association, echo = FALSE}
reduced_data <-survey_data
data <- survey_data
ethnicity <-table(data$vote_2020, data$race_ethnicity)
#Create a plot of how ethnicities tend to vote
barplot(ethnicity, cex.names = 0.5, beside=TRUE, main="Respondents Voting Habits By Ethnicity", xlab= "Ethnicity", legend.text = c("Donald Trump", "Joe Biden"), col = c("red", "blue"))
```
```{r genderplot, echo=FALSE}
#Make graph comparing voting habits of male and female voteds
gen_vote<-table(reduced_data$gender, reduced_data$vote_2020)
col = c("red","blue")
barplot(gen_vote, names.arg=c("Donald Trump", "Joe Biden"), beside = TRUE, legend.text = TRUE, col = col, border = "white", main="How Respondents Plan to Vote in 2020 By Gender", ylab="Number of respondents", xlab="Options for 2020 American Election", cex.names = 0.7)
```

```{r ageplot, echo=FALSE}
gen_vote<-table(data$vote_2020, data$age)
barplot(gen_vote, beside = TRUE, legend.text = c("Donald Trump", "Joe Biden"), col = col, border = "white", main="How Respondents Plan to Vote in 2020 By Age Group", ylab="Number of respondents", xlab="Age Groups in Years", cex.names = 0.7)
```

```{r votecompare}
#Filter Data for Donald Trump Voters in 2016
vote_compareD <-filter(data, vote_2016=="Donald Trump")
vote_compareD <-table(vote_compareD$vote_2020)

#Filter Data for Hillary Clinton Voters in 2016
vote_compareHi <-filter(data, vote_2016=="Hillary Clinton")
vote_compareH <-table(vote_compareHi$vote_2020)

par(mfrow = c(1:2))
barplot(vote_compareD, names.arg=c("Donald Trump", "Joe Biden"), col = col, cex.names = 0.7, xlab="Voted for Trump in 2016", legend.text = c("Donald Trump", "Joe Biden"))
barplot(vote_compareH, names.arg=c("Donald Trump", "Joe Biden"), col= col, cex.names = 0.7, xlab="Voted for Clinton in 2016", legend.text = c("Donald Trump", "Joe Biden"))
```
```{r partyassoc, echo=FALSE}
vote_D <-filter(reduced_data, vote_2020=="0")
ideo <-table(vote_D$ideo5)
pie(ideo, main="Political Party Association of Respondents Voting for Donald Trump")
vote_J <-filter(reduced_data, vote_2020=="1")
ideoJ <-table(vote_J$ideo5)

pie(ideo, main="Political Party Association of Respondents Voting for Donald Trump")
pie(ideoJ, main="Political Party Association of Respondents Voting for Joe Biden")

```
```{r income, echo=FALSE}
vote_D <-filter(reduced_data, vote_2020=="0")
vote_J <-filter(reduced_data, vote_2020=="1")
income <-rbind(table(vote_J$household_income), table(vote_D$household_income))
par(las=2)
barplot(income, beside = TRUE, cex.names = 0.50, legend.text = c("Joe Biden", "Donald Trump"), col = c("blue", "red"), main = "Voting Tendencies of Respondents by Income Brackets", ylab="Number of Respondents")

```

```{r, echo=FALSE}
states <-rbind(table(vote_J$state), table(vote_D$state))
par(las=2)
barplot(states, beside = TRUE, cex.names = 0.50, legend.text = c("Joe Biden", "Donald Trump"), col = c("blue", "red"), main = "Voting Tendencies of Respondents by State Brackets", ylab="Number of Respondents")

```

```{r ElectoralVotes, echo=FALSE}
#creates table of states, number of electoral votes for that state, votes for biden and votes for trump
Electoral_votes_by_state <- matrix(c(3,9,6,11,55,9,7,3,3,29,16,4,6,4,20,11,
                                     6,8,8,11,10,4,16,10,10,6,3,15,3,5,4,14,
                                     5,6,29,18,7,7,20,4,9,3,11,38,6,13,3,12,10,5,3),
                                   ncol=1, byrow=TRUE)
rownames(Electoral_votes_by_state) <- c("AK","AL","AR","AZ","CA","CO","CT","DC","DE",
                                        "FL","GA","HI","IA","ID","IL","IN","KS","KY",
                                        "LA","MA","MD","ME","MI","MN","MO","MS","MT",
                                        "NC","ND","NE","NH","NJ","NM","NV","NY","OH",
                                        "OK","OR","PA","RI","SC","SD","TN","TX","UT",
                                        "VA","VT","WA","WI","WV","WY")
colnames(Electoral_votes_by_state) <- "Number of Votes"

votes_for_biden_states <- states[1,]
votes_for_trump_states <- states[2,]

Electoral_votes_by_state <- tibble(Electoral_votes_by_state)
Electoral_votes_by_state <- Electoral_votes_by_state %>% 
  mutate(States = c("AK","AL","AR","AZ","CA","CO","CT","DC","DE",
                                        "FL","GA","HI","IA","ID","IL","IN","KS","KY",
                                        "LA","MA","MD","ME","MI","MN","MO","MS","MT",
                                        "NC","ND","NE","NH","NJ","NM","NV","NY","OH",
                                        "OK","OR","PA","RI","SC","SD","TN","TX","UT",
                                        "VA","VT","WA","WI","WV","WY"), 
         "Number of Votes" = matrix(c(3,9,6,11,55,9,7,3,3,29,16,4,6,4,20,11,
                                     6,8,8,11,10,4,16,10,10,6,3,15,3,5,4,14,
                                     5,6,29,18,7,7,20,4,9,3,11,38,6,13,3,12,10,5,3),
                                   ncol=1, byrow=TRUE),
         "Votes for Biden" = votes_for_biden_states,
         "Votes for Trump" = votes_for_trump_states)


Electoral_votes_by_state <- Electoral_votes_by_state %>% 
  select(States, `Number of Votes`, `Votes for Biden`, `Votes for Trump`)

votes <- Electoral_votes_by_state %>% 
  select(`Number of Votes`, `Votes for Biden`,`Votes for Trump`)

```


```{r CensusAnalysis, echo=FALSE}
census_data %>% 
  ggplot(aes(x=gender)) +
  geom_bar(fill='red', color='black')+
  theme(panel.background = element_rect(fill = "lightblue", colour = "lightblue", size = 0.5, linetype = "solid")) +
  labs(x="Gender",
       y="Number of Respondents",
       title="Gender Proportion in Census data")


census_data %>% 
  ggplot(aes(x=age)) +
  geom_bar(fill='red', color='black')+
  theme(panel.background = element_rect(fill = "lightblue", colour = "lightblue", size = 0.5, linetype = "solid")) +
  labs(x="Age range",
       y="Number of Respondents",
       title="Age range in the US")


pie(table(census_data$race_ethnicity), main = "Ethnicity")

census_data %>% 
  ggplot(aes(x=hispanic)) +
  geom_bar(fill='red', color='black')+
  theme(panel.background = element_rect(fill = "lightblue", colour = "lightblue", size = 0.5, linetype = "solid")) +
  labs(x="Hispanic",
       y="Number of Respondents",
       title="Hispanic Proportion in Census data")

pie(table(census_data$employment), main = "Employment Status")

pie(table(census_data$household_income), main = "Household income")
```

```{r population_distribution, echo=FALSE}
# Graph rough population distribution based on census
pop <- census_data %>%
  group_by(state) %>%
  summarise(n = n())

pop <- pop %>%
  rename(
    fips = state,
  )

pop$fips <- fips(pop$fips)
plot_usmap(data=pop, regions="states", values="n", color="black") +
  scale_fill_continuous( low = "white", high = "blue", 
                         name = "Responses", label = scales::comma
  ) + 
  theme(legend.position = "right") + 
  theme(panel.background = element_rect(colour = "black")) + 
  labs(title = "Figure X: Responses by State", caption = "Source: ACS 2018")
```

```{r income_distribution_by_state, echo=FALSE}
#Census data
par(las=2)
colcol = c("grey", "grey2", "steelblue", "steelblue2", "steelblue3", "steelblue4")
barplot(table(census_data$household_income, census_data$state), cex.names = 0.5, col = colcol, main ="Estimates of Income Stratification By State")
legend("topright", 
       legend = c("Upper Middle Income", "Under Poverty Line", "Lower Middle Income", "Low Income", "High Income", "Very High Income"), 
       fill = colcol, ncol = 2,
       cex = 0.75)
```
```{r Race_By_State,  echo=FALSE}
#Census Data
par(las=2)
barplot(table(census_data$race_ethnicity,  census_data$state), cex.names = 0.5, col = hcl.colors(5, "Reds 3"), main ="Distribution of Race Ethnicities By State", legend.text= TRUE)
```
```{r hispanic_distribution, echo=FALSE}

# Graph distribution of Hispanic population in U.S.A.
b <- census_data %>%
  group_by(state, hispanic) %>%
  summarise(n = n())

b <- b %>% group_by(state) %>%
  mutate(n = n/sum(n))

b <- b %>%
  filter(hispanic == "Hispanic")

b <- b %>% 
  rename(
    fips = state,
    )

b$fips <- fips(b$fips)
b$hispanic <- NULL

b$n = 100 * b$n

plot_usmap(data=b, regions="states", values="n", color="black") +
  scale_fill_continuous( low = "white", high = "orange", 
                         name = "% Hispanic Responses", label = scales::comma
  ) + 
  theme(legend.position = "right") + 
  theme(panel.background = element_rect(colour = "black")) + 
  labs(title = "Figure X: Proportion of Hispanic Respondents", caption = "Source: ACS 2018")

```


## Model
```{r model, echo=FALSE}
post_stratified_estimates <- read_csv("post_stratified_data.csv")
model <- read_rds("outputs/model/brms_model_states8.rds")
summary(model)

```


## Results

```{r graph_state_intervals, echo=FALSE, message=FALSE, fig.height=8, fig.width=16}

post_stratified_estimates <- read_csv("post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(state, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(state) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(post_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(state), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("State") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(state), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14) +
  labs(title = "Figure X: Proportion of Votes for Biden by State"))

```

After fitting our Bayesian multilevel regression model with poststratification, we find that Biden is at an advantage for winning the election. We see in Figure X above, where we plot the predicted proportion of Biden votes in each state according to our estimate from MRP, as well as the raw estimate according to the survey. In particular we plot the mean of the predicted proportion of Biden votes among voters and the 95% credibility interval. We notice that the raw estimate of Biden proportions does not well represent the estimate after MRP in many cases, especially in states that have small sample sizes.


```{r graph_gender_votes, echo=FALSE, message=FALSE, fig.height=3}

# Read in post stratified data
gender_stratified_estimates <- read_csv("gender_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(gender, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(gender) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(gender_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(gender), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Gender") +
  labs(title = "Figure X: Proportion of Votes for Biden by Gender") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(gender), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 12))

```

```{r age stratified, echo=FALSE, message=FALSE, fig.width=8}
# Read in age stratified data
age_stratified_estimates <- read_csv("outputs/post_stratified_csv/age_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(age, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(age) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(age_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(age), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Age") +
  labs(title = "Figure X: Proportion of Votes for Biden by Age") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(age), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14))


```

We also plot similar confidence intervals for voters after poststratification based on the other categories such as gender, income, age, race, and employment status. Based on gender in Figure X, we find that women are more likely to vote for the Democrats as opposed to men. We also see based on age in Figure Y that younger voters under the age of 34 tend to vote Democratic and those above that threshold are more likely to vote Republican.


```{r race stratified, echo=FALSE, message=FALSE, fig.width=8}
# Read in race stratified data
race_stratified_estimates <- read_csv("race_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(race_ethnicity, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(race_ethnicity) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

race_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(race_ethnicity), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Race/Ethnicity") +
  labs(title = "Figure X: Proportion of Votes for Biden by Race/Ethnicity") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(race_ethnicity), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14)


```
```{r hispanic stratified, echo=FALSE, message=FALSE, fig.width=8}

# Read in hispanic stratified data
hispanic_stratified_estimates <- read_csv("outputs/post_stratified_csv/hispanic_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(hispanic, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(hispanic) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(hispanic_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(hispanic), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Hispanic") +
  labs(title = "Figure X: Proportion of Votes for Biden by Hispanic Heritage") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(hispanic), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14))

```


We find in Figure Y that in terms of race, self-identified Hispanic individuals are much less likely to vote for Trump as compared to their non-Hispanic counterparts. As for race in Figure Z, white Americans and native Americans are the only two racial groups that are more likely to vote for Trump than Biden. However one thing of note, the credibility interval for native Americans is much larger than the one for white Americans. We also see that black Americans vote overwhelmingly for Biden whereas voters of Asian/Pacific Islander descent as those self-identified as mixed or other racial groups skew towards the Democrats to a smaller degree.


```{r income stratified, echo=FALSE, message=FALSE, fig.width=8}

# Read in income stratified data
income_stratified_estimates <- read_csv("outputs/post_stratified_csv/income_post_stratified_data.csv")
income_stratified_estimates$household_income[1] = "Very High Income"

# Clean raw data to be graphed
a <- survey_data %>%
  group_by(household_income, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(household_income) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

a$household_income[1] = "Very High Income"

suppressMessages(income_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(household_income), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Income") +
  labs(title = "Figure X: Proportion of Votes for Biden by Income") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(household_income), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14)) +
  theme(axis.text.x = element_text(angle = 90))


```
```{r employment stratified, echo=FALSE, message=FALSE, fig.width=8}

# Read in employment stratified data
employment_stratified_estimates <- read_csv("outputs/post_stratified_csv/employment_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(employment, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(employment) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(employment_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(employment), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Employment Status") +
  labs(title = "Figure X: Proportion of Votes for Biden by Employment") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(employment), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14))


```
When we examine voter preferences in terms of economic status, those who are unemployed or not in the labour force tend to swing towards Biden and the Democrats whereas the Republicans are favoured by those who are actively employed. We also find a clear trend that as an individual's household income increases, they are more likely to vote for the Republican Party.


```{r WinElectoralVotes, echo=FALSE}
#This chunk of code goes through the Electoral_votes_by_state data and sees who wins that state's electoral votes

#creates table of states, number of electoral votes for that state, votes for biden and votes for trump
Electoral_votes_by_state <- matrix(c(3,9,6,11,55,9,7,3,3,29,16,4,6,4,20,11,
                                     6,8,8,11,10,4,16,10,10,6,3,15,3,5,4,14,
                                     5,6,29,18,7,7,20,4,9,3,11,38,6,13,3,12,10,5,3),
                                   ncol=1, byrow=TRUE)
rownames(Electoral_votes_by_state) <- c("AK","AL","AR","AZ","CA","CO","CT","DC","DE",
                                        "FL","GA","HI","IA","ID","IL","IN","KS","KY",
                                        "LA","MA","MD","ME","MI","MN","MO","MS","MT",
                                        "NC","ND","NE","NH","NJ","NM","NV","NY","OH",
                                        "OK","OR","PA","RI","SC","SD","TN","TX","UT",
                                        "VA","VT","WA","WI","WV","WY")
colnames(Electoral_votes_by_state) <- "Number of Votes"

x <- 1
Biden_votes = 0
Trump_votes = 0

while (x<52) {
  ifelse(post_stratified_estimates$winner[x] == 1,
         Biden_votes <- 
           Biden_votes + Electoral_votes_by_state[x],
         Trump_votes <- 
           Trump_votes + Electoral_votes_by_state[x])
  x = x+1
}

#Who ever gets 270 or more electoral votes win
```

```{r percent biden map, echo=FALSE, message=FALSE}

post_stratified_estimates$mean = 100 * post_stratified_estimates$mean

#graph percentage Biden vote
post_stratified_estimates %>%
  statebins::statebins(value_col = "mean", state_col = "state", light_label = "black") +
  scale_fill_continuous( low = "#e8f4f8", high = "#2166ac", 
                         name = "% Biden", label = scales::comma
  ) +
  labs(title="Figure Z: Distribution of Votes for Biden in 2020 US Election") + theme(
      panel.background=element_blank(), axis.line=element_blank(),
      axis.text.x=element_blank(), axis.text.y=element_blank(),
      axis.ticks=element_blank(), axis.title.x=element_blank(),
      axis.title.y=element_blank()
    )
```


Combining all of this data using poststratification to adjust for the relative proportion of each group. Our model predicts that we have Biden narrowly winning the popular vote with almost 50.4% of all ballots cast nationally.

```{r popular vote, include=FALSE, echo=FALSE, message=FALSE}
# Read in full post stratified data
full_stratified_estimates <- read_csv("outputs/post_stratified_csv/full_post_stratified_data.csv")

sum(full_stratified_estimates$mean)
sum(full_stratified_estimates$lower)
sum(full_stratified_estimates$upper)
```

```{r electoral map winners, echo=FALSE}

# Graph electoral college
electoral_map <- post_stratified_estimates %>%
  mutate(value = ifelse(winner == 0, "Trump", "Biden")) %>%
  statebins::statebins(font_size=4, dark_label = "white", light_label = "white",
    ggplot2_scale_function = scale_fill_manual,
    name = "Winner",
    values = c(Biden = "#2166ac", Trump = "#b2182b")) + theme(
      panel.background=element_blank(), axis.line=element_blank(),
      axis.text.x=element_blank(), axis.text.y=element_blank(),
      axis.ticks=element_blank(), axis.title.x=element_blank(),
      axis.title.y=element_blank()
    ) +
  labs(title="Figure X: 2020 US Election Electoral College Predictions")

electoral_map
```

  However, since the U.S. election is decided by the electoral college and not by a national popular vote, we must examine which states each candidate achieved a plurality. For the vast majority of states, the winner of the popular vote in each state is awarded all of the state's electoral college votes. For our analysis, we assume that Biden will win any states where the mean proportion of Biden voters is greater than 50% and that Trump will win the remaining states. As seen in Figure Y, we predict that Biden will win a lot of the American South, the East, Hawaii and California whereas Trump is predicted to win much of New England, Midwest, Alaska and the Western U.S. 
  When we sum up the weight of these states and their electoral votes we predict Biden to win 284 electoral college votes to Trump's 254. 

## Discussion

## References

Tausanovitch, Chris and Lynn Vavreck. 2020. Democracy Fund + UCLA Nationscape, October 10-17, 2019 (version 20200814). Retrieved from https://www.voterstudygroup.org/downloads?key=1b155ffb-aa7a-432a-826e-6b8876e493ac.
