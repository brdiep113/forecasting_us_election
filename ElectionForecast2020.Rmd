---
title: "Biden To Win the 2020 U.S. Popular Vote and Electoral College"
author: "Jin Long Cao, Brian Diep, Johnathan Tillman, Tanya Woloshansky"
date: "2/11/2020"
output: pdf_document
---

```{r setup, include=FALSE}

#Import libraries
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(broom)
library(brms)
library(here)
library(skimr)
library(usmap)
library(ggplot2)
library(RColorBrewer)

# Download datasets and run scripts first to get these csv files
census_data <- read_csv("census_data.csv")
survey_data <- read_csv("survey_data.csv")
```


## Keywords
BIDEN, TRUMP, 2020 US ELECTION, FORECASTING, MULTILEVEL REGRESSION WITH POSTSTRATIFICATION

## Abstract

  The U.S. election is one of the most important political processes in the world, the outcome of which can completely change the direction of American domestic and foreign policy. Thus it is relevant to many observers whether the Republican Party under Donald Trump will remain a second-term or if the Democratic Party under Joe Biden will replace him in the 2020 election. We approach forecasting the election by combining survey and census data from the Nationscapes and ACS respectively, in order to perform a multilevel regression using a Bayesian hierarchical model with poststratification. Through this methodology we predict that Biden is likely to win the popular vote with approximately 50.4% of the votes as well as the electoral college by winning 284 electoral votes over Trump's 254 votes.

## Introduction

  The 2020 U.S. federal election is shaping up to be one of the most divisive and hotly contested elections in recent history. Important issues such as climate change, gun control, COVID-19 response, and foreign trade policy are being discussed during this election cycle. The two major parties, the Republicans and the Democrats, are at odds for many of these key issues. This makes forecasting the election an important task for Americans and non-Americans alike. Although a key part of the electoral tradition is placed on the significance of each individual's vote, we can still find that almost all voters fall into broad categories that constitute voting blocs. These blocs can be united from many disparate categories such as age, race, and state of residence and many voters will identify with multiple blocs simultaneously. Although this is not an easy task, an analysis of these blocs can allow pollsters to predict the outcome of the federal election. For our purposes we combine individual survey data from the Democratic Fund's Nationscape Study and census data from the 2018 American Community Survey (ACS) to use a multilevel regression with poststratification. 
    
  In order to use Bayesian multilevel logistic modelling, variables associated with voter preference were extracted from the Nationscape study. In particular, age, state, income, race, gender, Hispanic identity and employment were decided upon as predictors since exploratory analysis of the data showed a significant relationship (p-value less than 0.05 via logistic regression models) with these and voting intentions. Poststratification was performed using the ACS data to incorporate the population distributions of the U.S. population. The outcome of our simulation, which paid attention to the Electoral college wins rather than the popular vote, predicted Joe Biden as the winner of the 2020 election. 

  This work will continue to further explore the data sets used in our modelling, summarizing features of the data and visualizing variables of interest to our model. Next the features of our model and post-stratification process are described prior to simulating the election on the Electoral College. Finally, the prediction of Joe Biden's win will be investigated further and a discussion follows into strengths and weaknesses of the model, why this information is useful and further avenues of study. 

## Data

## Nationscape Data

  The dataset we used for our analysis came from responses to the Nationscape survey. The survey is the result of a partnership between the Democracy Fund Voter Study Group and two Political Scientists at UCLA (Chris Tausanovitch and Lynn Vavreck). The Nationscape survey runs from July 2019 to December 2020, interviewing 6250 people per week for a total of 500,000 respondents. The population of interest for the study is everyone eligible to vote in the US and the population frame are all the respondents sent by the market research platform Lucid to the Nationscape team. The team sampled the respondents sent until a quota on different demographic groups of age, gender, ethnicity, region, income, and education were reached. 

  The individual samples of 6250 respondents were sent directly from Lucid to the Nationscape survey software. Of the 6250 survey invitations sent, only about 75% of those surveys are included in the data as 12% decline immediately. Around 5% of the respondents are omitted because they stop participating during the survey and 8% are removed for speeding through the survey or straight line selecting answers. Lucid also requires an attention check before the survey is conducted and their supply partners that help form samples are evaluated by third party data specialists to ensure accurate representation of the target population..

	The Nationscape team used a simple raking technique to transform their dataset to more accurately represent the US voting population. Raking involves adjusting weights of different demographic groups of a dataset to be proportional to the population of interest. The data is also checked for representativeness in a process used by Pew Research center. To do so, a number of questions are asked which are found on reliable, large scale, government surveys. Estimates from Nationscape surveys are then compared with government surveys, and the difference was in line with that produced by Pew Research.

  When mining for important variables, there were many categories where questions were not asked of all participants. While this is necessary to avoid too many people quitting the survey, some questions had a concrete answer for only 25% of respondents (such as the query regarding Medicare). Another weakness of the survey is that it is only available online and in English, which may deter those who are not comfortable with technology or English. Since the survey is done online, the frame is limited to all Americans that have access to the internet, are reachable online and own a device that is compatible with the software. The survey itself was also only available in English, thus limiting representation from non-native english speakers.
 




```{r race_association, echo = FALSE}
reduced_data <-survey_data
data <- survey_data
ethnicity <-table(data$vote_2020, data$race_ethnicity)
#Create a plot of how ethnicities tend to vote
barplot(ethnicity, cex.names = 0.5, beside=TRUE, main="Figure 1. Respondents Voting Habits By Ethnicity", xlab= "Ethnicity", legend.text = c("Donald Trump", "Joe Biden"), col = c("red", "blue"))
```
Ethnicities, as shown by the Nationscape data, tend to favour the democratic candidate, Joe Biden. White voters on the other hand, appear to be planning their vote for Trump
```{r genderplot, echo=FALSE}
#Make graph comparing voting habits of male and female voteds
gen_vote<-table(reduced_data$gender, reduced_data$vote_2020)
col = c("red","blue")
barplot(gen_vote, names.arg=c("Donald Trump", "Joe Biden"), beside = TRUE, legend.text = TRUE, col = col, border = "white", main="Figure 2. How Respondents Plan to Vote in 2020 By Gender", ylab="Number of respondents", xlab="Options for 2020 American Election", cex.names = 0.7)
```
Another trend that the Nationscape data demonstrates is that female voters tend to prefer Joe Biden over Donald Trump. Male voters planned to vote the other way and support the incumbent president.

```{r ageplot, echo=FALSE}
gen_vote<-table(data$vote_2020, data$age)
barplot(gen_vote, beside = TRUE, legend.text = c("Donald Trump", "Joe Biden"), col = col, border = "white", main="Figure 3. How Respondents Plan to Vote in 2020 By Age Group", ylab="Number of respondents", xlab="Age Groups in Years", cex.names = 0.7)
```
Before 35 years of age, the voter preference strongly prefers Joe Biden. Respondents over this age seem to slightly prefer Donald Trump but some age groups are too close to call. 

```{r partyassoc, echo=FALSE}
vote_D <-filter(reduced_data, vote_2020=="0")
ideo <-table(vote_D$ideo5)
pie(ideo, main="Figure 4. Political Party Association of Respondents Voting for Donald Trump")
vote_J <-filter(reduced_data, vote_2020=="1")
ideoJ <-table(vote_J$ideo5)


pie(ideoJ, main=" Figure 5. Political Party Association of Respondents Voting for Joe Biden")

```
Not much crossing of party lines appears to be happening with the Nationscape data. Most of those who plan to vote for Biden range from very liberal to moderate. Likewise, respondents who consider themselves very conservative, conservative or moderate will be voting for Trump.

```{r income, echo=FALSE}
vote_D <-filter(reduced_data, vote_2020=="0")
vote_J <-filter(reduced_data, vote_2020=="1")
income <-rbind(table(vote_J$household_income), table(vote_D$household_income))
par(las=2)
barplot(income, beside = TRUE, cex.names = 0.50, legend.text = c("Joe Biden", "Donald Trump"), col = c("blue", "red"), main = "Figure 6. Voting Tendencies of Respondents by Income Brackets", ylab="Number of Respondents")

```
Income has also shown to be associated with voter preference with our Nationscape data. Lower incomes (those close to the poverty line or minimum wage earners) plan to strongly support Joe Biden. The Democratic Party continues to lead in all income levels (although more modestly) up until six figure earners where respondents flip and plan to vote for Trump. 

```{r education, echo= FALSE}
vote_D <-filter(reduced_data, vote_2020=="Donald Trump")
vote_J <-filter(reduced_data, vote_2020=="Joe Biden")
edu <-rbind(table(vote_J$education), table(vote_D$education))
colnames(edu) = c("< 3rd Grade", "Grade 4-8", "Some HS", "HS Grad", "Vocational", "Some College", "Associate", "BA/B.Sc", "Some Graduate", "MA/M.Sc", "Dr")
barplot(edu, cex.names = 0.5, main="How Respondents at Varying Levels of Education Will Vote in 2020", xlab="Figure 7. Educational Levels", col = c("blue", "red"), legend.text = c("Joe Biden", "Donald Trump"))


```
Interestingly, education level of respondent did not show a relationship with voting intentions for the 2020 election. Across all education levels queried in the survey, an association with either candidate did not exist.  


```{r, echo=FALSE}
states <-rbind(table(vote_J$state), table(vote_D$state))
par(las=2)
barplot(states, beside = TRUE, cex.names = 0.50, legend.text = c("Joe Biden", "Donald Trump"), col = c("blue", "red"), main = "Figure 8. Voting Tendencies of Respondents by State Brackets", ylab="Number of Respondents")

```
Similar to education, it did not appear that states tended to favour any particular candidate in the Nationscape survey data. The race for the Whitehouse appeared to be fair game in all states at the time of this survey. 

## ACS Data 
Since we decided to poststratify via adjusting the weights of respondent groups using an additional dataset, we used the American Community Surveys (ACS) from 2018. The ACS is a reliable source of data on population parameters and is sent out to a sample of 3.5 million households and group quarters monthly. The population of interest for the ACS are all citizens of the US. The population frame for the ACS is the Master Address File (MAF) which consists of the Census Bureau’s known living quarters and some nonresidential units. The MAF includes households and group quarters where groups of people live together. In 2013 the survey methodology was updated to stop sending surveys to College dorms during summer months to improve response rates and lower costs.   

The Census Bureau first divides the US into five distinct sub-frames, each of which is utilized for a survey every five years to avoid oversampling specific areas. New addresses in each of these sub-frames are added each year systematically. After selecting the sub-frame for the year every block in the sub-frame is assigned a sampling rate based on sampling identities that affect their population like being in a school district or being in a Native reserve. The smallest sampling identity is used to determine the sampling rate for the block. After selection is finished the assigned blocks are grouped via stratum and geography to be systematically assigned to a month in the year to be surveyed.

Surveying each household in assigned blocks involves four phases of attempting contact. First the Census Bureau sends each household a request form to fill the survey out online and if not completed they mail a questionnaire to be returned by mail. If they still haven’t received a response they will follow up with a Computer Assisted Telephone Interview. Finally if a household has not answered any of the previous survey attempts they will conduct a Computer Assisted Personal Interview with a representative of the Bureau travelling to the address. 

After data selection occurs the Census Bureau weights the household respondents in three stages. First they weigh to account for the sampling rates they calculated previously via geography. Next they weigh the households to account for non-responding households in the same block to account for the reduced sampling rate. Finally they weigh the households via age, sex, race and Hispanic origin to match their population estimates program. 

Although the ACS has a very comprehensive sampling design they only select a small sample size of 295 000 of more than 180 million households to be sampled each month preventing accurate representation through a robust sample size. Additionally since the Census Bureau uses multiple methods of completing the ACS survey differing measurement error are present and not consistent among households sampled. 

```{r ElectoralVotes, echo=FALSE}
#creates table of states, number of electoral votes for that state, votes for biden and votes for trump
Electoral_votes_by_state <- matrix(c(3,9,6,11,55,9,7,3,3,29,16,4,6,4,20,11,
                                     6,8,8,11,10,4,16,10,10,6,3,15,3,5,4,14,
                                     5,6,29,18,7,7,20,4,9,3,11,38,6,13,3,12,10,5,3),
                                   ncol=1, byrow=TRUE)
rownames(Electoral_votes_by_state) <- c("AK","AL","AR","AZ","CA","CO","CT","DC","DE",
                                        "FL","GA","HI","IA","ID","IL","IN","KS","KY",
                                        "LA","MA","MD","ME","MI","MN","MO","MS","MT",
                                        "NC","ND","NE","NH","NJ","NM","NV","NY","OH",
                                        "OK","OR","PA","RI","SC","SD","TN","TX","UT",
                                        "VA","VT","WA","WI","WV","WY")
colnames(Electoral_votes_by_state) <- "Number of Votes"

votes_for_biden_states <- states[1,]
votes_for_trump_states <- states[2,]

Electoral_votes_by_state <- tibble(Electoral_votes_by_state)
Electoral_votes_by_state <- Electoral_votes_by_state %>% 
  mutate(States = c("AK","AL","AR","AZ","CA","CO","CT","DC","DE",
                                        "FL","GA","HI","IA","ID","IL","IN","KS","KY",
                                        "LA","MA","MD","ME","MI","MN","MO","MS","MT",
                                        "NC","ND","NE","NH","NJ","NM","NV","NY","OH",
                                        "OK","OR","PA","RI","SC","SD","TN","TX","UT",
                                        "VA","VT","WA","WI","WV","WY"), 
         "Number of Votes" = matrix(c(3,9,6,11,55,9,7,3,3,29,16,4,6,4,20,11,
                                     6,8,8,11,10,4,16,10,10,6,3,15,3,5,4,14,
                                     5,6,29,18,7,7,20,4,9,3,11,38,6,13,3,12,10,5,3),
                                   ncol=1, byrow=TRUE),
         "Votes for Biden" = votes_for_biden_states,
         "Votes for Trump" = votes_for_trump_states)


Electoral_votes_by_state <- Electoral_votes_by_state %>% 
  select(States, `Number of Votes`, `Votes for Biden`, `Votes for Trump`)

votes <- Electoral_votes_by_state %>% 
  select(`Number of Votes`, `Votes for Biden`,`Votes for Trump`)

```


```{r CensusAnalysis, echo=FALSE}
census_data %>% 
  ggplot(aes(x=gender)) +
  geom_bar(fill='red', color='black')+
  theme(panel.background = element_rect(fill = "lightblue", colour = "lightblue", size = 0.5, linetype = "solid")) +
  labs(x="Gender",
       y="Number of Respondents",
       title="Figure 9. Gender Proportion in Census data")


census_data %>% 
  ggplot(aes(x=age)) +
  geom_bar(fill='red', color='black')+
  theme(panel.background = element_rect(fill = "lightblue", colour = "lightblue", size = 0.5, linetype = "solid")) +
  labs(x="Age range",
       y="Number of Respondents",
       title="Figure 10. Age range in the US")

pie(table(census_data$employment), main = "Figure 11. Employment Status")
```

```{r population_distribution, echo=FALSE}
# Graph rough population distribution based on census
pop <- census_data %>%
  group_by(state) %>%
  summarise(n = n())

pop <- pop %>%
  rename(
    fips = state,
  )

pop$fips <- fips(pop$fips)
plot_usmap(data=pop, regions="states", values="n", color="black") +
  scale_fill_continuous( low = "white", high = "blue", 
                         name = "Responses", label = scales::comma
  ) + 
  theme(legend.position = "right") + 
  theme(panel.background = element_rect(colour = "black")) + 
  labs(title = "Figure 12: Responses by State", caption = "Source: ACS 2018")
```

```{r income_distribution_by_state, echo=FALSE}
#Census data
par(las=2)
colcol = c("grey", "grey2", "steelblue", "steelblue2", "steelblue3", "steelblue4")
barplot(table(census_data$household_income, census_data$state), cex.names = 0.5, col = colcol, main ="Figure 13: Estimates of Income Stratification By State")
legend("topright", 
       legend = c("Upper Middle Income", "Under Poverty Line", "Lower Middle Income", "Low Income", "High Income", "Very High Income"), 
       fill = colcol, ncol = 2,
       cex = 0.75)
```

```{r Race_By_State,  echo=FALSE}
#Census Data
par(las=2)
barplot(table(census_data$race_ethnicity,  census_data$state), cex.names = 0.5, col = hcl.colors(5, "Reds 3"), main ="Figure 14: Distribution of Race Ethnicities By State", legend.text= TRUE)
```

```{r hispanic_distribution, echo=FALSE}

# Graph distribution of Hispanic population in U.S.A.
b <- census_data %>%
  group_by(state, hispanic) %>%
  summarise(n = n())

b <- b %>% group_by(state) %>%
  mutate(n = n/sum(n))

b <- b %>%
  filter(hispanic == "Hispanic")

b <- b %>% 
  rename(
    fips = state,
    )

b$fips <- fips(b$fips)
b$hispanic <- NULL

b$n = 100 * b$n

plot_usmap(data=b, regions="states", values="n", color="black") +
  scale_fill_continuous( low = "white", high = "orange", 
                         name = "% Hispanic Responses", label = scales::comma
  ) + 
  theme(legend.position = "right") + 
  theme(panel.background = element_rect(colour = "black")) + 
  labs(title = "Figure 15: Proportion of Hispanic Respondents", caption = "Source: ACS 2018")

```
## Data Cleaning
From the ACS and Nationscape data, we removed invalid incomes/null values, null/other employment, third party/non-voters and education from the sample. As those values did not highly affect the outcome and in the case of non-voters, their vote is not relevant to an accurate analysis of who will actually cast votes during the election.

## Model
```{r model, echo=FALSE, include=FALSE}
post_stratified_estimates <- read_csv("post_stratified_data.csv")
model <- read_rds("outputs/model/brms_model_states8.rds")
summary(model)
vconv(model)
```
A Bayesian multilevel logistic model with post-stratification was used to predict the plurality for each state in the US 2020 election. We used a logistic model as they can associate binary and continuous independent variables with a binary categorical response variable. Since the decision of which major party to vote for is condensed to a binary response variable, the logistic model is well suited for our goal of predicting the election winner. Linear models were unsuited for our goals as they require the response variable to be a continuous variable such as height. Our response variable was either 0 (representing a vote for Trump) or 1( representing a vote for Biden), which is binary in nature.

Mathematically with a logistic model we can express the probability 'p' that an individual will vote for the Democratic Party as a logarithmic function of the various dependent variables.

$$log(\frac{p}{1 - p}) = \beta_0 + \beta_1x_1 + \beta_2x_2 + ... + \beta_kx_k$$
	
	For a logistic model to be valid, we also need certain conditions to be true with our data. This includes the independence of each observation, low covariance between any pair of explanatory variables, and that any given predicted value of probability is independent of each other predicted value.

We know that the first assumption holds due to the survey design which is sampled randomly. We also know that the second assumption holds due to our covariance matrix where all values are low which indicates little to no covariance between our explanatory variables (the code for covariance matrix is located in the model section of the rmd file). 

We decided to make the model multilevel in order to group voters by state. Since each state varies significantly in voting preference and demographic groups we saw it fit to analyze plurality of each state separately. Most importantly, the electoral college also assigns electoral votes based on plurality of each state so to predict the winner of the US 2020 election we needed to separate the predictions via state. MRP also allows us to generalize our findings based on a possibly unrepresentative sample by correcting with external demographic data (Wu & Thompson 2020). However, multilevel modelling with poststratification does not allow us to firmly establish a causal relationship between our independent and dependent variables (Gelman & Kennedy 2020). MRP also requires a large dataset containing the demographics of the population in order to be useful. For our purposes, this condition is fulfilled since the ACS comprehensively details all the demographic information that is relevant to our analysis.

We used a Bayesian approach rather than a Frequentist to allow a credible interval to be produced. The Bayesian approach involves updating the probability of an event based on prior knowledge affecting the event. Even though we use noninformative prior information--known as a prior--the method allows us to create a credible interval in which we are 95% certain our results will occur. If we used a Frequentist method that uses proportions or frequencies of the data we can only make a confidence interval that shows if the elections were repeated 100 times our result would occur 95 times. Bayesian models are known to account for any cause of uncertainty in inferences specifically for predictions.  

We decided to use a Bernoulli distribution as a noninformative prior to make our model since it has two outcomes: either a failure (0) or a success (1). Other distributions with binary outcomes like the Binomial Distribution involve sampling with replacement of individuals in each sample, which is not observed in the sampling methods of the Nationscape and ACS datasets.

The Bayesian approach to logistic regression involves predicting the parameters using the typical approach to Bayesian inference involving the priors. If we express our model in mathematical notation we are returned the form: 

$$P(\beta_0, \beta_1, …, \beta_k| y, X_1,...,X_k) \propto P(y, X_1,...,X_k|\beta_0, \beta_1, …, \beta_k) * P(\beta_0, \beta_1, …, \beta_k)$$

where y represents the probability of an individual voter voting for Biden. Specifically our model predicts the outcome of the average voter that we can generalize to the entire US voting population. The beta values represent our independent variables, specifically age, income, employment status, sex, state, race, and whether or not an individual is Hispanic. We decided to use poststratification when making our model to accurately depict the US voting population. To reduce any non-response bias we weighted different demographic groups to represent the population of interest. 

The dependent variables that we decided to fit our model on were some of the relevant variables found in the data exploration section such as gender, age, employment status, household income, and race/ethnicity including Hispanic heritage. 

We decided to group ages of voters in brackets of 10 years and income based on varying brackets to distinguish different economic groups. This allowed us to easily interpret relationships found between voting preference and age and economic groups. Modelling these variables as continuous does not show us the relationships between differing groups and makes it harder to view the representation of these groups for poststratification. The other categories were group based on convenience as the samples of 

Our model was fit using brms and Stan in R.

## Results

```{r graph_state_intervals, echo=FALSE, message=FALSE, fig.height=8, fig.width=16}

post_stratified_estimates <- read_csv("post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(state, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(state) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(post_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(state), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("State") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(state), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14) +
  labs(title = "Figure 16: Proportion of Votes for Biden by State"))

```

After fitting our Bayesian multilevel regression model with poststratification, we find that Biden is at an advantage for winning the election. We see in Figure 16 above, where we plot the predicted proportion of Biden votes in each state according to our estimate from MRP, as well as the raw estimate according to the survey. In particular we plot the mean of the predicted proportion of Biden votes among voters and the 95% credibility interval. We notice that the raw estimate of Biden proportions does not well represent the estimate after MRP in many cases, especially in states that have small sample sizes.

```{r graph_gender_votes, echo=FALSE, message=FALSE, fig.height=3}

# Read in post stratified data
gender_stratified_estimates <- read_csv("gender_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(gender, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(gender) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(gender_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(gender), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Gender") +
  labs(title = "Figure 17: Proportion of Votes for Biden by Gender") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(gender), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 12))

```

```{r age stratified, echo=FALSE, message=FALSE, fig.width=8}
# Read in age stratified data
age_stratified_estimates <- read_csv("outputs/post_stratified_csv/age_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(age, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(age) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(age_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(age), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Age") +
  labs(title = "Figure 18: Proportion of Votes for Biden by Age") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(age), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14))


```

We also plot similar confidence intervals for voters after poststratification based on the other categories such as gender, income, age, race, and employment status. Based on gender in Figure 17, we find that women are more likely to vote for the Democrats as opposed to men. We also see based on age in Figure 18 that younger voters under the age of 34 tend to vote Democratic and those above that threshold are more likely to vote Republican.


```{r race stratified, echo=FALSE, message=FALSE, fig.width=8}
# Read in race stratified data
race_stratified_estimates <- read_csv("race_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(race_ethnicity, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(race_ethnicity) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

race_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(race_ethnicity), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Race/Ethnicity") +
  labs(title = "Figure 19: Proportion of Votes for Biden by Race/Ethnicity") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(race_ethnicity), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14)


```
```{r hispanic stratified, echo=FALSE, message=FALSE, fig.width=8}

# Read in hispanic stratified data
hispanic_stratified_estimates <- read_csv("outputs/post_stratified_csv/hispanic_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(hispanic, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(hispanic) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(hispanic_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(hispanic), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Hispanic") +
  labs(title = "Figure 20: Proportion of Votes for Biden by Hispanic Heritage") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(hispanic), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14))

```


We find in Figure 20 that in terms of race, self-identified Hispanic individuals are much less likely to vote for Trump as compared to their non-Hispanic counterparts. As for race in Figure 19, white Americans and native Americans are the only two racial groups that are more likely to vote for Trump than Biden. However one thing of note, the credibility interval for native Americans is much larger than the one for white Americans. We also see that black Americans vote overwhelmingly for Biden whereas voters of Asian/Pacific Islander descent as those self-identified as mixed or other racial groups skew towards the Democrats to a smaller degree.


```{r income stratified, echo=FALSE, message=FALSE, fig.width=8}

# Read in income stratified data
income_stratified_estimates <- read_csv("outputs/post_stratified_csv/income_post_stratified_data.csv")
income_stratified_estimates$household_income[1] = "Very High Income"

# Clean raw data to be graphed
a <- survey_data %>%
  group_by(household_income, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(household_income) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

a$household_income[1] = "Very High Income"

suppressMessages(income_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(household_income), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Income") +
  labs(title = "Figure 21: Proportion of Votes for Biden by Income") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(household_income), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14)) +
  theme(axis.text.x = element_text(angle = 90))


```

```{r employment stratified, echo=FALSE, message=FALSE, fig.width=8}

# Read in employment stratified data
employment_stratified_estimates <- read_csv("outputs/post_stratified_csv/employment_post_stratified_data.csv")
# Clean raw data to be graphed
a <- survey_data %>%
  group_by(employment, vote_2020) %>%
  summarise(n = n())

a <- a %>% group_by(employment) %>%
  mutate(prop = n/sum(n))

a <- a %>% 
  filter(vote_2020 == 1)

suppressMessages(employment_stratified_estimates %>%
  ggplot(aes(y = mean, x = forcats::fct_inorder(employment), color = "MRP estimate")) +
  geom_point() +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
  ylab("Proportion voting for Biden") +
  xlab("Employment Status") +
  labs(title = "Figure 22: Proportion of Votes for Biden by Employment") +
  geom_point(data = a, aes(y = prop, x = forcats::fct_inorder(employment), color = "Raw data")) +
  scale_color_manual(name = "", values = c("MRP estimate" = "black", "Raw data" = "red")) +
  geom_hline(yintercept=0.5, linetype="dashed", color = "steel blue") +
  theme_bw(base_size = 14))


```

Figure 21 and 22 when we examine voter preferences in terms of economic status, those who are unemployed or not in the labour force tend to swing towards Biden and the Democrats whereas the Republicans are favoured by those who are actively employed. We also find a clear trend that as an individual's household income increases, they are more likely to vote for the Republican Party.


```{r WinElectoralVotes, echo=FALSE}
#This chunk of code goes through the Electoral_votes_by_state data and sees who wins that state's electoral votes

#creates table of states, number of electoral votes for that state, votes for biden and votes for trump
Electoral_votes_by_state <- matrix(c(3,9,6,11,55,9,7,3,3,29,16,4,6,4,20,11,
                                     6,8,8,11,10,4,16,10,10,6,3,15,3,5,4,14,
                                     5,6,29,18,7,7,20,4,9,3,11,38,6,13,3,12,10,5,3),
                                   ncol=1, byrow=TRUE)
rownames(Electoral_votes_by_state) <- c("AK","AL","AR","AZ","CA","CO","CT","DC","DE",
                                        "FL","GA","HI","IA","ID","IL","IN","KS","KY",
                                        "LA","MA","MD","ME","MI","MN","MO","MS","MT",
                                        "NC","ND","NE","NH","NJ","NM","NV","NY","OH",
                                        "OK","OR","PA","RI","SC","SD","TN","TX","UT",
                                        "VA","VT","WA","WI","WV","WY")
colnames(Electoral_votes_by_state) <- "Number of Votes"

x <- 1
Biden_votes = 0
Trump_votes = 0

while (x<52) {
  ifelse(post_stratified_estimates$winner[x] == 1,
         Biden_votes <- 
           Biden_votes + Electoral_votes_by_state[x],
         Trump_votes <- 
           Trump_votes + Electoral_votes_by_state[x])
  x = x+1
}

#Who ever gets 270 or more electoral votes win
```

```{r percent biden map, echo=FALSE, message=FALSE}

post_stratified_estimates$mean = 100 * post_stratified_estimates$mean

#graph percentage Biden vote
post_stratified_estimates %>%
  statebins::statebins(value_col = "mean", state_col = "state", light_label = "black") +
  scale_fill_continuous( low = "#e8f4f8", high = "#2166ac", 
                         name = "% Biden", label = scales::comma
  ) +
  labs(title="Figure 23: Distribution of Votes for Biden in 2020 US Election") + theme(
      panel.background=element_blank(), axis.line=element_blank(),
      axis.text.x=element_blank(), axis.text.y=element_blank(),
      axis.ticks=element_blank(), axis.title.x=element_blank(),
      axis.title.y=element_blank()
    )
```


Combining all of this data using poststratification to adjust for the relative proportion of each group. Our model predicts that we have Biden narrowly winning the popular vote with almost 50.4% of all ballots cast nationally.

```{r popular vote, include=FALSE, echo=FALSE, message=FALSE}
# Read in full post stratified data
full_stratified_estimates <- read_csv("outputs/post_stratified_csv/full_post_stratified_data.csv")

sum(full_stratified_estimates$mean)
sum(full_stratified_estimates$lower)
sum(full_stratified_estimates$upper)
```

```{r electoral map winners, echo=FALSE}

# Graph electoral college
electoral_map <- post_stratified_estimates %>%
  mutate(value = ifelse(winner == 0, "Trump", "Biden")) %>%
  statebins::statebins(font_size=4, dark_label = "white", light_label = "white",
    ggplot2_scale_function = scale_fill_manual,
    name = "Winner",
    values = c(Biden = "#2166ac", Trump = "#b2182b")) + theme(
      panel.background=element_blank(), axis.line=element_blank(),
      axis.text.x=element_blank(), axis.text.y=element_blank(),
      axis.ticks=element_blank(), axis.title.x=element_blank(),
      axis.title.y=element_blank()
    ) +
  labs(title="Figure 24: 2020 US Election Electoral College Predictions")

electoral_map
```

  However, since the U.S. election is decided by the electoral college and not by a national popular vote, we must examine which states each candidate achieved a plurality. For the vast majority of states, the winner of the popular vote in each state is awarded all of the state's electoral college votes. For our analysis, we assume that Biden will win any states where the mean proportion of Biden voters is greater than 50% and that Trump will win the remaining states. As seen in Figure 24, we predict that Biden will win a lot of the American South, the East, Hawaii and California whereas Trump is predicted to win much of New England, Midwest, Alaska and the Western U.S. 
  When we sum up the weight of these states and their electoral votes we predict Biden to win 284 electoral college votes to Trump's 254. 

## Discussion
Using a Bayesian multilevel logistic regression model composed of age, race, hispanic identity, home state, gender, employment status and income level variables; we found that Joe Biden would win the 2020 presidential election in terms of the electoral college as well as the popular vote. However, we should continue to analyze the reasons as to why Joe Biden is favoured to win the elections and whether these trends can be used to predict future elections.

Our model shows that the core supporters for the Democratic Party as well as the Republican Party can be deconstructed to consist of clear groups based on social and economic class. It is evident from our results that Republicans tend to skew towards being white, male, older, and have higher household incomes compared to Democrats who gather much of their support from women, racial minorities, and lower/middle class voters.

As seen from our census data, there are more people above the age of 45 than there are below as well as more white people than any other ethnicity. These make up a core part of Donald Trump’s and the Republicans’ voter base. Traditionally, higher income earners also tend to vote Republican due to their favourable policies regarding wealth, which our data also supports. 

However, we also note that there are more female, middle class and lower economic class voters which are all groups that are predicted to favour Joe Biden. Not only were these variables significantly associated with voter outcomes, but current literature agrees that younger, female, non-white voters tend to be associated with the Democratic Party (Pew Research Center 2020).
 
Although our model is being fit using data from a year unique in several ways (i.e. global pandemic), the fact that the variables chosen are verified by literature based on previous elections is important. It helps ensure that the model has not been overfit and can possibly be used as a template for future elections.

Racial data seen in our results also shows that the vote is heavily divided on racial lines, this suggests that Biden is much more likely to win in states that have higher proportions of ethnic minorities, in particular black/African Americans and those of Hispanic heritage. This is clear from graphs above where Biden has significant wins in the American South, where black and Hispanic voters make up a large percentage of the state population.

Our analysis only took into account demographic information about voters, and completely omitted ideological factors. Thus, the voting trends that are seen in our model exposes a major rift within American society. This rift appears to be drawn particularly on racial and class lines and suggests that they still play a heavy role in the political process.  We expect that these divisions will continue to be exacerbated as these themes become increasingly politicized. As American society continues to diversify, if we do not see a bridging of social and economic inequality, we are likely to see greater polarization between the parties.

The model described in this paper is based on the outcomes of voting within Electoral colleges rather than the popular vote. Recent elections in 2016 and 2000 have shown that the popular vote and Electoral college may not agree so it is important to simulate models using the latter. Studies have found a bias in the Electoral college towards Republicans historically but other simulations for the 2020 elections have determined similar outcomes with the Democrats leading.

We also find that our analysis is most confident in states where the credibility interval for the proportion of votes for Biden in states that have their mean further away from 0.5. These states are more likely to be “safe” and their races will be less competitive than others since there is likely to be a clear front runner. However, for states like Tennessee, New Jersey, and Arkansas, we see that the mean is incredibly close to the 0.5 threshold and we predict that these will be competitive swing states that could determine the outcome of the election.

## References
Brandon, E. (2020). “Why Older Citizens are More Likely to Vote.” Retrieved from: https://money.usnews.com/money/retirement/aging/articles/why-older-citizens-are-more-likely-to-vote.

Bürkner, P (2017). brms: An R Package for Bayesian Multilevel Models Using Stan. Journal of Statistical Software, 80(1), 1-28. doi:10.18637/jss.v080.i01 

Bürkner, P (2018). Advanced Bayesian Multilevel Modeling with the R Package brms. The R Journal, 10(1), 395-411. doi:10.32614/RJ-2018-017

Desilver, D. (2014). “The politics of American generations: How age affects attitudes and voting behavior.” Retrieved from: https://www.pewresearch.org/fact-tank/2014/07/09/the-politics-of-american-generations-how-age-affects-attitudes-and-voting-behavior/.

Di Lorenzo, P (2020). usmap: US Maps Including Alaska and Hawaii. R package version 0.5.1. Retrieved from: https://CRAN.R-project.org/package=usmap. 

Encyclopedia Brittanica. (n.d.). “United States Electoral College Votes by State.” Retrieved from: https://www.britannica.com/topic/United-States-Electoral-College-Votes-by-State-1787124.

Erikson, R., Sigman, K., & Yao, L. (2020). “Electoral College bias and the 2020 presidential election”. Retrieved from: https://www.pnas.org/content/early/2020/10/22/2013581117.

Flood, S., Goeken, R., Grover, J.,  Meyer, E., Pacas, J., & Sobek, M (2020). IPUMS USA: Version 10.0 [dataset]. Minneapolis, MN: IPUMS. Retrieved from: https://doi.org/10.18128/D010.V10.0.

Frey, W. (2020). “Older Voters May Secure A Biden Victory in 2020's Swing States”. Retrieved November from: https://www.brookings.edu/blog/the-avenue/2020/10/28/older-voters-may-secure-a-biden-victory-in-2020s-swing-states/.

Gelman, A., & Kennedy, L. (2020). “Know your population and know your model: Using model-based regression and post-stratification to generalize findings beyond the observed sample.” Retrieved from: https://arxiv.org/pdf/1906.11323.pdf  

JJ Allaire et al. (2020). rmarkdown: Dynamic Documents for R. R package version 2.3. Retrieved from:   https://rmarkdown.rstudio.com.

Pew Research Center. (2016). “Ideological Gap Widens Between More, Less Educated Adults”. Retrieved from: https://www.pewresearch.org/politics/2016/04/26/a-wider-ideological-gap-between-more-and-less-educated-adults/.

Pew Research Center. (2020).  “Trends in party affiliation among demographic groups”.   
      Retrieved from:  
      https://www.pewresearch.org/politics/2018/03/20/1-trends-in-party-affiliation-among-
     demographic-groups/.

R Core Team. (2020). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. Retrieved from: https://www.R-project.org/.

Robinson, D., Hayes, A., & Couch, S. (2020). broom: Convert Statistical Objects into Tidy Tibbles. R Package version 0.7.0 Retrieved from: https://CRAN.R-project.org/package=broom. 

Rosentiel, T. (2007). “Money Walks”. Retrieved from: https://www.pewresearch.org/2007/04/12/money-walks/.

Rudis, B. (2020). statebins: Create United States Uniform Cartogram Heatmaps. R package version 1.4.0. Retrieved from:  https://CRAN.R-project.org/package=statebins.

Tausanovitch, C., & Lynn V. (2019). Democracy Fund + UCLA Nationscape(version 20200814). Retrieved from https://www.voterstudygroup.org/downloads?key=1b155ffb-aa7a-432a-826e-6b8876e493ac.

The Economist. (2020). “How will Donald Trump’s covid-19 infection affect the election?” Retrieved from: https://www.economist.com/united-states/2020/10/02/how-will-donald-trumps-covid-19-infection-affect-the-election?fbclid=IwAR33_5og5cqlosoP36fplLcNn6w1qd0smgqQpZZrBXOUwReann7RtvR0bw0. 

Wickham, H. (2016). ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag. New York.

Wickham, H., & Miller, E. (2020). haven: Import and Export 'SPSS',  'Stata' and 'SAS' Files. R package version 2.3.1. Retrieved from: https://CRAN.R-project.org/package=haven.

Wickham et al. (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686. Retrieved from: https://doi.org/10.21105/joss.01686.

Wu, C., & Thompson, M. (2020). Sampling Theory and Practice, Springer.
